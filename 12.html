<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ようこそ友達 - Enhanced Streaming</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
            color: #00ff41;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Subtle animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(0, 255, 65, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 255, 65, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(0, 255, 65, 0.02) 0%, transparent 50%);
            animation: pulse 8s ease-in-out infinite alternate;
            pointer-events: none;
        }

        @keyframes pulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.6; }
        }

        .container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-size: clamp(24px, 4vw, 36px);
            font-weight: 600;
            color: #00ff41;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        .tagline {
            font-size: clamp(14px, 2vw, 16px);
            font-weight: 300;
            color: #00ff41;
            opacity: 0.7;
            letter-spacing: 1px;
        }

        .search-section {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 18px 55px 18px 20px;
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 400;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            outline: none;
            color: #00ff41;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: #00ff41;
            opacity: 0.5;
        }

        .search-input:focus {
            border-color: #00ff41;
            box-shadow: 0 0 0 3px rgba(0, 255, 65, 0.1);
            background: rgba(0, 0, 0, 0.9);
        }

        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .search-input:focus + .search-icon {
            opacity: 1;
        }

        .search-icon svg {
            width: 100%;
            height: 100%;
            stroke: #00ff41;
            stroke-width: 2;
        }

        /* NEW: Content Toggle Switch */
        .content-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 300px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: rgba(0, 255, 65, 0.7);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: rgba(0, 255, 65, 0.2);
            border-color: #00ff41;
            color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .toggle-btn:hover:not(.active) {
            background: rgba(0, 255, 65, 0.1);
        }

        .results-container {
            width: 100%;
            max-width: 600px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid rgba(0, 255, 65, 0.2);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .results-container.show {
            display: block;
        }

        .results-container::-webkit-scrollbar {
            width: 6px;
        }

        .results-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .results-container::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 65, 0.3);
            border-radius: 3px;
        }

        .result-item {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .result-item:hover {
            background: rgba(0, 255, 65, 0.05);
            transform: translateY(-1px);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-poster {
            width: 50px;
            height: 75px;
            border-radius: 8px;
            object-fit: cover;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid rgba(0, 255, 65, 0.2);
            flex-shrink: 0;
        }

        .result-content {
            flex: 1;
            min-width: 0;
        }

        .result-title {
            font-weight: 500;
            color: #00ff41;
            margin-bottom: 6px;
            font-size: 16px;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .result-meta {
            color: #00ff41;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0.7;
        }

        .result-type {
            text-transform: uppercase;
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .result-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .loading, .error, .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #00ff41;
            font-size: 16px;
            opacity: 0.8;
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            color: #ff4444;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 65, 0.3);
            border-radius: 50%;
            border-top-color: #00ff41;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 450px;
            color: #00ff41;
            backdrop-filter: blur(20px);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #00ff41;
        }

        .modal-subtitle {
            color: #00ff41;
            opacity: 0.7;
            font-size: 14px;
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #00ff41;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff41;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            border-color: #00ff41;
            box-shadow: 0 0 0 3px rgba(0, 255, 65, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff41;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(0, 255, 65, 0.1);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: rgba(0, 255, 65, 0.2);
            border-color: #00ff41;
        }

        .btn-primary:hover {
            background: rgba(0, 255, 65, 0.3);
        }

        .loading-text {
            text-align: center;
            color: #00ff41;
            margin: 12px 0;
            font-style: italic;
            opacity: 0.8;
            font-size: 13px;
        }

        /* Media Player Section */
        .player-container {
            width: 100%;
            max-width: 800px;
            margin: 40px 0;
            display: none;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 65, 0.2);
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.1);
        }

        .player-container.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-title {
            font-size: 18px;
            font-weight: 500;
            color: #00ff41;
        }

        .close-player {
            background: none;
            border: none;
            color: #00ff41;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .close-player:hover {
            opacity: 1;
        }

        .player-frame-container {
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
        }

        .player-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Player Controls */
        .player-controls {
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-top: 1px solid rgba(0, 255, 65, 0.1);
            background: rgba(0, 0, 0, 0.7);
        }

        /* Legal Disclaimer Modal */
        .disclaimer-content {
            max-width: 500px;
            padding: 30px;
        }

        .disclaimer-content h2 {
            color: #ff5555;
            margin-bottom: 15px;
            text-align: center;
        }

        .disclaimer-content ul {
            margin: 15px 0 20px 20px;
        }

        .disclaimer-content li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .disclaimer-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* TV Show Selection Columns */
        .season-episode-container {
            display: flex;
            gap: 15px;
            max-height: 300px;
            overflow: hidden;
        }

        .seasons-column, .episodes-column {
            flex: 1;
            overflow-y: auto;
            border: 1px solid rgba(0, 255, 65, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
        }

        .seasons-column {
            max-width: 40%;
        }

        .season-item, .episode-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 255, 65, 0.1);
        }

        .season-item:hover, .episode-item:hover {
            background: rgba(0, 255, 65, 0.1);
            transform: translateY(-2px);
        }

        .season-item.active {
            background: rgba(0, 255, 65, 0.2);
            border-color: #00ff41;
        }

        .season-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .season-episodes {
            font-size: 12px;
            opacity: 0.8;
        }

        .episode-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .episode-number {
            font-size: 12px;
            opacity: 0.8;
        }

        .column-header {
            font-weight: 500;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.2);
        }
        
        /* NEW: Top Rated Grid */
        .top-grid {
            width: 100%;
            max-width: 800px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .grid-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 255, 65, 0.1);
            transition: all 0.3s ease;
            aspect-ratio: 2/3;
            cursor: pointer;
        }
        
        .grid-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 65, 0.2);
            border-color: rgba(0, 255, 65, 0.4);
        }
        
        .grid-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .grid-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 50%, transparent);
            padding: 15px 10px 10px;
        }
        
        .grid-title {
            font-size: 14px;
            font-weight: 500;
            color: #00ff41;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .grid-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(0, 255, 65, 0.8);
        }
        
        .grid-rating {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .grid-type {
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                margin-bottom: 15px;
            }

            .search-input {
                padding: 16px 50px 16px 16px;
                font-size: 15px;
            }

            .result-item {
                padding: 16px;
                gap: 14px;
            }

            .result-poster {
                width: 45px;
                height: 67px;
            }

            .result-title {
                font-size: 15px;
            }

            .result-meta {
                font-size: 12px;
            }

            .modal-content {
                padding: 24px 20px;
                margin: 20px;
            }

            .modal-title {
                font-size: 18px;
            }
            
            .player-container {
                margin: 30px 0;
            }

            .season-episode-container {
                flex-direction: column;
                max-height: 400px;
            }

            .seasons-column {
                max-width: 100%;
            }
            
            .top-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 15px;
            }
            
            .toggle-btn {
                padding: 10px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .search-input {
                padding: 14px 45px 14px 14px;
                font-size: 14px;
            }

            .result-item {
                padding: 14px;
                gap: 12px;
            }

            .result-poster {
                width: 40px;
                height: 60px;
            }

            .result-title {
                font-size: 14px;
            }

            .result-meta {
                font-size: 11px;
                gap: 8px;
            }

            .modal-content {
                padding: 20px 16px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 13px;
            }
            
            .player-title {
                font-size: 16px;
            }
            
            .top-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                gap: 12px;
            }
            
            .toggle-btn {
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Legal Disclaimer Modal -->
    <div class="modal show" id="disclaimerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">⚠️ Legal & Usage Disclaimer</h2>
            </div>
            <div class="modal-body">
                <p>Please read this disclaimer carefully before using this application:</p>
                
                <ul>
                    <li><strong>Third-Party Content</strong>: This application provides access to third-party content. We do not host, store, or distribute any media files on our servers. Users are solely responsible for verifying the legality of any content they access according to their local laws.</li>
                    
                    <li><strong>Personal Use Only</strong>: For personal and educational use only. Avoid public distribution or mass sharing.</li>
                    
                    <li><strong>Use a VPN</strong>: Always connect through a reliable VPN to protect your privacy and comply with local regulations.</li>
                    
                    <li><strong>No App Store Publishing</strong>: Do not upload or distribute this app on app stores or public platforms. Doing so may violate intellectual property laws.</li>
                    
                    <li><strong>Legal Consultation Recommended</strong>: Planning a public release? Consult a qualified intellectual property attorney to ensure compliance with copyright and content distribution laws.</li>
                </ul>
                
                <p>By using this application, you acknowledge and agree to these terms.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="acceptDisclaimer">I Understand & Agree</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">ようこそ友達</div>
            <div class="tagline">discover • watch • enjoy</div>
        </div>
        
        <!-- Search Bar at Top -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search movies and series..." id="searchInput">
                <div class="search-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- NEW: Content Toggle Switch -->
        <div class="content-toggle">
            <button class="toggle-btn active" id="moviesBtn">Movies</button>
            <button class="toggle-btn" id="tvBtn">TV Shows</button>
        </div>
        
        <!-- Top Rated Grid -->
        <div class="top-grid" id="topGrid"></div>

        <div class="results-container" id="resultsContainer">
        </div>

        <div class="player-container" id="playerContainer">
            <div class="player-header">
                <div class="player-title" id="playerTitle">Now Playing</div>
                <button class="close-player" id="closePlayer">&times;</button>
            </div>
            <div class="player-frame-container">
                <iframe class="player-frame" id="mediaPlayer" allowfullscreen></iframe>
            </div>
            <div class="player-controls" id="playerControls">
                <button class="btn" id="changeSeasonBtn">Change Season</button>
                <button class="btn" id="changeEpisodeBtn">Change Episode</button>
            </div>
        </div>

        <!-- Season/Episode Selection Modal -->
        <div class="modal" id="seasonModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalTitle">Select Episode</h2>
                    <p class="modal-subtitle" id="modalSubtitle">Choose your episode</p>
                </div>
                <div class="modal-body">
                    <div class="loading-text" id="loadingText">Loading seasons and episodes...</div>
                    
                    <div class="season-episode-container" id="seasonEpisodeContainer" style="display: none;">
                        <div class="seasons-column">
                            <div class="column-header">Seasons</div>
                            <div id="seasonsList"></div>
                        </div>
                        <div class="episodes-column">
                            <div class="column-header">Episodes</div>
                            <div id="episodesList"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class StreamSearch {
            constructor() {
                this.apiKey = 'b312a5bf89f444b2fdc45b6570fbb2c5';
                this.searchInput = document.getElementById('searchInput');
                this.resultsContainer = document.getElementById('resultsContainer');
                this.playerContainer = document.getElementById('playerContainer');
                this.mediaPlayer = document.getElementById('mediaPlayer');
                this.playerTitle = document.getElementById('playerTitle');
                this.closePlayer = document.getElementById('closePlayer');
                this.currentTvShow = null;
                this.currentSeason = null;
                this.currentEpisode = null;
                this.seasonsList = document.getElementById('seasonsList');
                this.episodesList = document.getElementById('episodesList');
                this.seasonEpisodeContainer = document.getElementById('seasonEpisodeContainer');
                this.loadingText = document.getElementById('loadingText');
                this.disclaimerModal = document.getElementById('disclaimerModal');
                this.playerControls = document.getElementById('playerControls');
                this.changeSeasonBtn = document.getElementById('changeSeasonBtn');
                this.changeEpisodeBtn = document.getElementById('changeEpisodeBtn');
                
                // NEW: Toggle buttons and grid
                this.moviesBtn = document.getElementById('moviesBtn');
                this.tvBtn = document.getElementById('tvBtn');
                this.topGrid = document.getElementById('topGrid');
                this.currentContentType = 'movies'; // Default content type
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                
                // Load top movies on startup
                this.loadTopRatedMovies();
            }

            setupEventListeners() {
                let searchTimeout;
                
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    const query = e.target.value.trim();
                    
                    if (query.length < 2) {
                        this.hideResults();
                        return;
                    }
                    
                    searchTimeout = setTimeout(() => {
                        this.performSearch(query);
                    }, 500);
                });

                this.closePlayer.addEventListener('click', () => {
                    this.closePlayerContainer();
                });
                
                // Accept disclaimer button
                document.getElementById('acceptDisclaimer').addEventListener('click', () => {
                    this.disclaimerModal.classList.remove('show');
                    setTimeout(() => {
                        this.disclaimerModal.style.display = 'none';
                    }, 300);
                });
                
                // Season/Episode buttons
                this.changeSeasonBtn.addEventListener('click', () => {
                    if (this.currentTvShow) {
                        this.openSeasonModal(this.currentTvShow);
                    }
                });
                
                this.changeEpisodeBtn.addEventListener('click', () => {
                    if (this.currentTvShow && this.currentSeason) {
                        document.getElementById('seasonModal').classList.add('show');
                    }
                });
                
                // NEW: Content toggle buttons
                this.moviesBtn.addEventListener('click', () => {
                    if (this.currentContentType !== 'movies') {
                        this.switchContentType('movies');
                    }
                });
                
                this.tvBtn.addEventListener('click', () => {
                    if (this.currentContentType !== 'tv') {
                        this.switchContentType('tv');
                    }
                });
            }
            
            // NEW: Switch between movies and TV shows
            switchContentType(type) {
                this.currentContentType = type;
                
                // Update active button
                this.moviesBtn.classList.toggle('active', type === 'movies');
                this.tvBtn.classList.toggle('active', type === 'tv');
                
                // Clear grid and show loading
                this.topGrid.innerHTML = '<div class="loading">Loading<span class="loading-spinner"></span></div>';
                
                // Load appropriate content
                if (type === 'movies') {
                    this.loadTopRatedMovies();
                } else {
                    this.loadTopRatedTVShows();
                }
            }

            async performSearch(query) {
                this.showLoading();
                
                try {
                    const [movieResponse, tvResponse] = await Promise.all([
                        fetch(`https://api.themoviedb.org/3/search/movie?api_key=${this.apiKey}&query=${encodeURIComponent(query)}`),
                        fetch(`https://api.themoviedb.org/3/search/tv?api_key=${this.apiKey}&query=${encodeURIComponent(query)}`)
                    ]);

                    const movieData = await movieResponse.json();
                    const tvData = await tvResponse.json();

                    const results = [
                        ...movieData.results.map(item => ({...item, media_type: 'movie'})),
                        ...tvData.results.map(item => ({...item, media_type: 'tv'}))
                    ].sort((a, b) => b.popularity - a.popularity).slice(0, 10);

                    this.displayResults(results);
                } catch (error) {
                    this.showError('Failed to search. Please check your internet connection.');
                    console.error('Search error:', error);
                }
            }

            displayResults(results) {
                if (results.length === 0) {
                    this.showNoResults();
                    return;
                }

                const html = results.map(item => {
                    const title = item.title || item.name;
                    const year = item.release_date || item.first_air_date ? 
                        new Date(item.release_date || item.first_air_date).getFullYear() : '';
                    const poster = item.poster_path ? 
                        `https://image.tmdb.org/t/p/w154${item.poster_path}` : 
                        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNzUiIHZpZXdCb3g9IjAgMCA1MCA3NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9Ijc1IiBmaWxsPSJyZ2JhKDAsIDI1NSwgNjUsIDAuMSkiIHN0cm9rZT0icmdiYSgwLCAyNTUsIDY1LCAwLjMpIiByeD0iOCIvPgo8Y2lyY2xlIGN4PSIyNSIgY3k9IjM3LjUiIHI9IjgiIGZpbGw9InJnYmEoMCwgMjU1LCA2NSwgMC4zKSIvPgo8L3N2Zz4K';
                    
                    const rating = item.vote_average ? (item.vote_average / 2).toFixed(1) : 'N/A';
                    
                    const clickHandler = item.media_type === 'movie' ? 
                        `streamSearch.watchMovie(${JSON.stringify(item).replace(/"/g, '&quot;')})` : 
                        `streamSearch.openSeasonModal(${JSON.stringify(item).replace(/"/g, '&quot;')})`;
                    
                    return `
                        <div class="result-item" onclick="${clickHandler}">
                            <img src="${poster}" alt="${title}" class="result-poster" onerror="this.style.display='none'">
                            <div class="result-content">
                                <div class="result-title">${this.escapeHtml(title)}</div>
                                <div class="result-meta">
                                    <span class="result-type">${item.media_type}</span>
                                    ${year ? `<span>• ${year}</span>` : ''}
                                    <div class="result-rating">
                                        <span>★</span>
                                        <span>${rating}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                this.resultsContainer.innerHTML = html;
                this.showResults();
            }

            watchMovie(movie) {
                const url = `https://vidfast.pro/movie/${movie.id}`;
                this.playerTitle.textContent = movie.title;
                this.mediaPlayer.src = url;
                this.playerContainer.classList.add('show');
                this.playerControls.style.display = 'none'; // Hide controls for movies
                this.scrollToPlayer();
            }

            async openSeasonModal(tvShow) {
                this.currentTvShow = tvShow;
                this.currentSeason = null;
                this.currentEpisode = null;
                
                document.getElementById('modalTitle').textContent = `${tvShow.name || tvShow.title}`;
                document.getElementById('modalSubtitle').textContent = 'Choose your episode';
                
                document.getElementById('seasonModal').classList.add('show');
                
                // Show loading and hide columns
                this.loadingText.style.display = 'block';
                this.seasonEpisodeContainer.style.display = 'none';
                this.seasonsList.innerHTML = '';
                this.episodesList.innerHTML = '';
                
                await this.loadSeasons(tvShow.id);
            }

            async loadSeasons(tvId) {
                try {
                    const response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}?api_key=${this.apiKey}`);
                    const data = await response.json();
                    
                    // Filter out seasons with season_number > 0
                    const validSeasons = data.seasons.filter(season => season.season_number > 0);
                    
                    if (validSeasons.length > 0) {
                        this.loadingText.style.display = 'none';
                        this.seasonEpisodeContainer.style.display = 'flex';
                        
                        validSeasons.forEach(season => {
                            const seasonElement = document.createElement('div');
                            seasonElement.className = 'season-item';
                            seasonElement.innerHTML = `
                                <div class="season-title">${season.name}</div>
                                <div class="season-episodes">${season.episode_count} episodes</div>
                            `;
                            
                            seasonElement.addEventListener('click', () => {
                                this.selectSeason(season);
                            });
                            
                            this.seasonsList.appendChild(seasonElement);
                        });
                        
                        // Select first season by default
                        this.selectSeason(validSeasons[0]);
                    } else {
                        this.loadingText.innerHTML = 'No seasons available';
                    }
                } catch (error) {
                    console.error('Error loading seasons:', error);
                    this.loadingText.innerHTML = 'Error loading seasons';
                }
            }
            
            selectSeason(season) {
                this.currentSeason = season;
                
                // Highlight selected season
                document.querySelectorAll('.season-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.closest('.season-item').classList.add('active');
                
                this.loadEpisodes(this.currentTvShow.id, season.season_number);
            }

            async loadEpisodes(tvId, seasonNumber) {
                this.episodesList.innerHTML = '<div class="loading-text">Loading episodes...</div>';
                
                try {
                    const response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/season/${seasonNumber}?api_key=${this.apiKey}`);
                    const data = await response.json();
                    
                    this.episodesList.innerHTML = '';
                    
                    data.episodes.forEach(episode => {
                        const episodeElement = document.createElement('div');
                        episodeElement.className = 'episode-item';
                        episodeElement.innerHTML = `
                            <div class="episode-title">${episode.name}</div>
                            <div class="episode-number">Episode ${episode.episode_number}</div>
                        `;
                        
                        episodeElement.addEventListener('click', () => {
                            this.playEpisode(episode);
                        });
                        
                        this.episodesList.appendChild(episodeElement);
                    });
                    
                } catch (error) {
                    console.error('Error loading episodes:', error);
                    this.episodesList.innerHTML = '<div class="error">Error loading episodes</div>';
                }
            }
            
            playEpisode(episode) {
                this.currentEpisode = episode;
                const url = `https://vidfast.pro/tv/${this.currentTvShow.id}/${this.currentSeason.season_number}/${episode.episode_number}`;
                this.playerTitle.textContent = `${this.currentTvShow.name || this.currentTvShow.title} - S${this.currentSeason.season_number}E${episode.episode_number}`;
                this.mediaPlayer.src = url;
                this.playerContainer.classList.add('show');
                this.playerControls.style.display = 'flex'; // Show controls for TV shows
                this.scrollToPlayer();
                closeModal();
            }

            scrollToPlayer() {
                this.playerContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            closePlayerContainer() {
                this.playerContainer.classList.remove('show');
                this.mediaPlayer.src = '';
                this.playerControls.style.display = 'none';
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showResults() {
                this.resultsContainer.classList.add('show');
            }

            hideResults() {
                this.resultsContainer.classList.remove('show');
            }

            showLoading() {
                this.resultsContainer.innerHTML = `
                    <div class="loading">
                        Searching<span class="loading-spinner"></span>
                    </div>
                `;
                this.showResults();
            }

            showError(message) {
                this.resultsContainer.innerHTML = `<div class="error">${message}</div>`;
                this.showResults();
            }

            showNoResults() {
                this.resultsContainer.innerHTML = `
                    <div class="no-results">
                        <div style="font-size: 18px; margin-bottom: 8px;">No results found</div>
                        <div style="opacity: 0.7;">Try different keywords or check your spelling</div>
                    </div>
                `;
                this.showResults();
            }
            
            // Load top rated movies
            async loadTopRatedMovies() {
                try {
                    const response = await fetch(`https://api.themoviedb.org/3/movie/top_rated?api_key=${this.apiKey}&language=en-US&page=1`);
                    const data = await response.json();
                    this.displayTopItems(data.results.slice(0, 12), 'movie');
                } catch (error) {
                    console.error('Error loading top movies:', error);
                    this.topGrid.innerHTML = '<div class="error">Failed to load top movies</div>';
                }
            }
            
            // Load top rated TV shows
            async loadTopRatedTVShows() {
                try {
                    const response = await fetch(`https://api.themoviedb.org/3/tv/top_rated?api_key=${this.apiKey}&language=en-US&page=1`);
                    const data = await response.json();
                    this.displayTopItems(data.results.slice(0, 12), 'tv');
                } catch (error) {
                    console.error('Error loading top TV shows:', error);
                    this.topGrid.innerHTML = '<div class="error">Failed to load top TV shows</div>';
                }
            }
            
            // Display top-rated items in grid
            displayTopItems(items, type) {
                this.topGrid.innerHTML = '';
                
                items.forEach(item => {
                    const title = item.title || item.name;
                    const poster = item.poster_path ? 
                        `https://image.tmdb.org/t/p/w300${item.poster_path}` : 
                        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDMwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDUwIiBmaWxsPSJyZ2JhKDAsIDI1NSwgNjUsIDAuMSkiIHN0cm9rZT0icmdiYSgwLCAyNTUsIDY1LCAwLjMpIiByeD0iOCIvPgo8Y2lyY2xlIGN4PSIxNTAiIGN5PSIyMjUiIHI9IjQwIiBmaWxsPSJyZ2JhKDAsIDI1NSwgNjUsIDAuMykiLz4KPC9zdmc+';
                    
                    const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'grid-item';
                    itemElement.innerHTML = `
                        <img src="${poster}" alt="${title}" class="grid-poster" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDMwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDUwIiBmaWxsPSJyZ2JhKDAsIDI1NSwgNjUsIDAuMSkiIHN0cm9rZT0icmdiYSgwLCAyNTUsIDY1LCAwLjMpIiByeD0iOCIvPgo8Y2lyY2xlIGN4PSIxNTAiIGN5PSIyMjUiIHI9IjQwIiBmaWxsPSJyZ2JhKDAsIDI1NSwgNjUsIDAuMykiLz4KPC9zdmc+'">
                        <div class="grid-info">
                            <div class="grid-title">${this.escapeHtml(title)}</div>
                            <div class="grid-meta">
                                <div class="grid-rating">
                                    <span>★</span>
                                    <span>${rating}</span>
                                </div>
                                <div class="grid-type">${type === 'movie' ? 'MOVIE' : 'TV'}</div>
                            </div>
                        </div>
                    `;
                    
                    itemElement.addEventListener('click', () => {
                        if (type === 'movie') {
                            this.watchMovie(item);
                        } else {
                            this.openSeasonModal(item);
                        }
                    });
                    
                    this.topGrid.appendChild(itemElement);
                });
            }
        }

        function closeModal() {
            document.getElementById('seasonModal').classList.remove('show');
        }

        let streamSearch;

        document.addEventListener('DOMContentLoaded', () => {
            streamSearch = new StreamSearch();
        });
    </script>
</body>
</html>